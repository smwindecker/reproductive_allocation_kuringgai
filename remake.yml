packages:
  - stats
  - stringr
  - smatr
  - plyr
  - tidyr
  - dplyr
  - xtable
  - igraph
  - rmarkdown
  - broom
  - ggtern
  - yaml
  - mgcv
  - knitr

sources:
  - R

include:
  - remake_species_data.yml

targets:
  all:
    depends:
      - export

  # Papers --------------------------------------
  ms-RA:
    depends:
    - ms/RA/figures/schematic.pdf
    - ms/RA/figures/RA_demo.pdf
    - ms/RA/figures/RA_all_h.pdf
    - ms/RA/figures/RA_all_a.pdf
    - ms/RA/figures/investment.pdf
    - ms/RA/figures/leaf_weight.pdf
    - ms/RA/figures/life_history.pdf
    - ms/RA/figures/height.pdf
    - ms/RA/figures/RA_demo_all.pdf

  ms/RA/figures/schematic.pdf:
    command: plotRASexamples()
    plot:
      height: 2.5
      width: 7.5

  ms/RA/figures/RA_demo.pdf:
    command: figure_allocation_demo_single(SummarySppAge)
    plot:
      width: 16
      height: 4

  ms/RA/figures/RA_demo_all.pdf:
    command: figure_allocation_demo_all(SummaryInd, SummarySppAge)
    plot:
      width: 16
      height: 32


  ms/RA/figures/RA_all_h.pdf:
    command: figure_allocation_all_h(SummaryInd, SummarySppAge)
    plot:
      width: 16
      height: 9

  ms/RA/figures/RA_all_a.pdf:
    command: figure_allocation_all_a(SummaryInd, SummarySppAge)
    plot:
      width: 16
      height: 9

  ms/RA/figures/life_history.pdf:
    command: figure_life_history(SummarySpp, SummarySppAge)
    plot:
      width: 8
      height: 8

  ms/RA/figures/investment.pdf:
    command: figure_investment_weight(SummaryInd)
    plot:
      width: 16
      height: 9

  ms/RA/figures/leaf_weight.pdf:
    command: figure_leaf_weight(Growth_all)
    plot:
      width: 16
      height: 9

  ms/RA/figures/height.pdf:
    command: figure_height(Growth_all)
    plot:
      width: 16
      height: 9

# ----------------

  ms-Accessory:
   depends:
    - ms/Accessory/figures/allocation.pdf
    - ms/Accessory/figures/seed_size_tests.pdf
    - ms/Accessory/figures/seed_size_scaling.pdf
    - ms/Accessory/figures/proxy.pdf
    - ms/Accessory/Wenk-Accessory-SI.pdf

  ms/Accessory/figures/allocation.pdf:
    command: figure_accessory_bar(SummarySpp)
    plot:
        width: 10
        height: 6

  ms/Accessory/figures/seed_size_tests.pdf:
    command: figure_accessory_v_seed_size(SummarySpp)
    plot:
        width: 8
        height: 8

  ms/Accessory/figures/seed_size_scaling.pdf:
    command: figure_scaling_costs_seed_size(SummarySpp)
    plot:
        width: 6
        height: 4

  ms/Accessory/figures/proxy.pdf:
    command: figure_proxy(SummaryInd)
    plot:
        width: 11
        height: 5

  ms/Accessory/Wenk-Accessory-SI.pdf:
    command: latex_build("ms/Accessory/Wenk-Accessory-SI.tex", clean=TRUE)

  ms/Accessory/Wenk-Accessory-SI.tex:
    knitr:
      auto_figure_prefix: true
      chdir: true
    depends:
      - SummaryInd
      - SummarySpp
      - SummarySppAge
      - HarvestData
      - Investment_FD_all
      - PartsSummary_all
      - ms/Accessory/Sup_Table_flowering_parts.csv
      - BAER_GraphMaps
      - BOLE_GraphMaps
      - COER_GraphMaps
      - EPMI_GraphMaps
      - GRBU_GraphMaps
      - GRSP_GraphMaps
      - HATE_GraphMaps
      - HEPU_GraphMaps
      - LEES_GraphMaps
      - PELA_GraphMaps
      - PEPU_GraphMaps
      - PHPH_GraphMaps
      - PILI_GraphMaps
      - PUTU_GraphMaps
      - R/figures.R

  # Data --------------------------------------
  IndividualsList:
    command: read_csv("data/individuals.csv")

  FlowerPartsData:
    command: read_csv("data/flowerParts.csv")

  Reproduction_raw:
    command: read_csv("data/reproduction.csv")

  ReproductionData:
    command: filterForAllocation(Reproduction_raw, IndividualsList)

  HarvestData_raw:
    command: read_csv("data/harvest.csv")

  HarvestData:
    command: preprocessHarvest(HarvestData_raw, IndividualsList)

  FloweringCategories:
    command: read_csv("data/flowerCategories.csv")

  MultiplierTable:
    command: read_csv("data/multiplierTable.csv")

  InvestmentCategories:
    command: yaml.load_file("data/accessoryParts.yml")

  LMA_1:
    command:
      - read_csv("data/LMA.csv")

  LMA:
    command:
      - process_LMA(LMA_1)

  wood_density_spp1:
    command:
      - read_csv("data/woodDensity.csv")

  wood_density_spp:
    command: process_wood_density(wood_density_spp1)

  seedsize:
    command:
      - read_csv("data/seedsize.csv")

  leavesPerLength_1:
    command:
      - read_csv("data/leaves_per_length.csv")

  leavesPerLength:
    command:
      - process_leaves_per_length(leavesPerLength_1)

  leafLoss_1:
    command:
      - read_csv("data/leaderGrowthLL.csv")

  leafLoss:
    command:
      - process_leaf_loss(leafLoss_1, leavesPerLength)

  variable_list:
    command:
      - read_csv("data/variable_names.csv")

  SummaryInd_1:
    command:
      - combine_by_individual(IndividualsList, Growth_all, ReproductiveCosts_all, LMA, leafLoss, wood_density_spp, seedsize)

  SummaryInd:
    command:
      - sort_by_variable(SummaryInd_1, variable_list)

  SummarySppAge:
    command: get_species_values(SummaryInd, groups=I(c("species", "age")))

  SummarySpp:
    command: get_species_values(SummaryInd, groups=I("species"))

  SummaryCombine:
    command: scale_individual_variable(SummaryInd, SummarySpp)

  export:
    depends:
      - export/SummaryInd.rds
      - export/SummarySpp.rds
      - export/SummarySppAge.rds
      - export/SummaryCombine.rds
      - export/HarvestData.rds
      - export/Investment_FD_all.rds
      - export/PartsSummary_all.rds

  export/SummaryInd.rds:
    command: saveRDS(SummaryInd, target_name)

  export/SummarySpp.rds:
    command: saveRDS(SummarySpp, target_name)

  export/SummarySppAge.rds:
    command: saveRDS(SummarySppAge, target_name)

  export/SummaryCombine.rds:
    command: saveRDS(SummaryCombine, target_name)

  export/HarvestData.rds:
    command: saveRDS(HarvestData, target_name)

  export/Investment_FD_all.rds:
    command: saveRDS(Investment_FD_all, target_name)

  export/PartsSummary_all.rds:
    command: saveRDS(PartsSummary_all, target_name)
